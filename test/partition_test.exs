defmodule GeoPartition.PartitionTest do
  use ExUnit.Case
  doctest GeoPartition.Partition

  alias GeoPartition.{Partition, Shapes}

  describe "maybe_split" do
    test "two holes" do
      shape = Shapes.top_level_test
      assert Partition.maybe_split(shape, 10) == [
        %Geo.Polygon{
          coordinates: [
            [
              {-93.08441162109374, 38.78406349514289},
              {-92.67242431640625, 39.157752153690964},
              {-93.1146240234375, 39.00637903337455},
              {-93.46343994140625, 39.18117526158749},
              {-93.08441162109374, 38.78406349514289}
            ],
            [
              {-93.37005615234375, 39.42346418978382},
              {-93.603515625, 39.16414104768742},
              {-93.09814453125, 38.83542884007305},
              {-92.82073974609375, 39.06184913429154},
              {-93.07891845703125, 38.90813299596705},
              {-93.526611328125, 39.16839998800286},
              {-93.37005615234375, 39.42346418978382}
            ],
            [
              {-93.31787109374999, 39.49344386279537},
              {-93.34465026855469, 39.46641460192054},
              {-93.31443786621094, 39.4669446883827},
              {-93.31787109374999, 39.49344386279537}
            ]
          ],
          properties: %{},
          srid: nil
        },
        %Geo.Polygon{
          coordinates: [
            [
              {-93.46343994140625, 39.18117526158749},
              {-93.1915283203125, 39.65011210186371},
              {-93.68865966796875, 39.142842478062505},
              {-93.08441162109374, 38.78406349514289},
              {-93.46343994140625, 39.18117526158749}
            ],
            [
              {-93.37005615234375, 39.42346418978382},
              {-93.603515625, 39.16414104768742},
              {-93.09814453125, 38.83542884007305},
              {-92.82073974609375, 39.06184913429154},
              {-93.07891845703125, 38.90813299596705},
              {-93.526611328125, 39.16839998800286},
              {-93.37005615234375, 39.42346418978382}
            ],
            [
              {-93.31787109374999, 39.49344386279537},
              {-93.34465026855469, 39.46641460192054},
              {-93.31443786621094, 39.4669446883827},
              {-93.31787109374999, 39.49344386279537}
            ]
          ],
          properties: %{},
          srid: nil
        }
      ]
    end
  end
end
